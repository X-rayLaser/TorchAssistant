{
    "session_dir": "pretrained",
    "initialize": {
        "definitions": [
            {
                "group": "datasets",
                "name": "train_ds",
                "spec": {
                    "class": "torchvision.datasets.MNIST",
                    "args": ["data"],
                    "kwargs": {
                        "train": true,
                        "download": true
                    }
                }
            },
            {
                "group": "datasets",
                "name": "test_ds",
                "spec": {
                    "class": "torchvision.datasets.MNIST",
                    "args": ["data"],
                    "kwargs": {
                        "train": false,
                        "download": true
                    }
                }
            },
            {
                "group": "collators",
                "name": "my_collator",
                "spec": {
                    "class": "examples.mnist.MyCollator"
                }
            },
            {
                "group": "loader_factories",
                "name": "training_factory",
                "spec": {
                    "dataset": "train_ds",
                    "collator": "my_collator",
                    "kwargs": {
                        "batch_size": 32,
                        "num_workers": 2
                    }
                }
            },
            {
                "group": "loader_factories",
                "name": "test_factory",
                "spec": {
                    "dataset": "test_ds",
                    "collator": "my_collator",
                    "kwargs": {
                        "batch_size": 32,
                        "num_workers": 2
                    }
                }
            },
            {
                "group": "models",
                "name": "LeNet5",
                "spec": {
                    "class": "examples.mnist.LeNet5"
                }
            },
            {
                "group": "optimizers",
                "name": "optimizer",
                "spec": {
                    "class": "Adam",
                    "kwargs": {
                        "lr": 0.01
                    },
                    "model": "LeNet5"
                }
            },
            {
                "group": "losses",
                "name": "cross_entropy",
                "spec": {
                    "class": "CrossEntropyLoss",
                    "inputs": ["y_hat", "input_2"],
                    "transform": "examples.mnist.convert_labels"
                }
            },
            {
                "group": "metrics",
                "name": "accuracy",
                "spec": {
                    "class": "Accuracy",
                    "inputs": ["y_hat", "input_2"],
                    "transform": "examples.mnist.reverse_onehot"
                }
            }
        ],
        "pipelines": {
            "training_pipeline": {
                "input_factories": [
                    {
                        "input_alias": "input_batch",
                        "loader_factory": "training_factory"
                    }
                ],
                "losses": [
                    {
                        "loss_name": "cross_entropy",
                        "loss_display_name": "loss"
                    }
                ],
                "metrics": [
                    {
                        "metric_name": "accuracy",
                        "display_name": "acc"
                    }
                ]
            },
            "evaluation_pipeline": {
                "input_factories": [
                    {
                        "input_alias": "input_batch",
                        "loader_factory": "test_factory"
                    }
                ],
                "losses": [
                    {
                        "loss_name": "cross_entropy",
                        "loss_display_name": "val loss"
                    }
                ],
                "metrics": [
                    {
                        "metric_name": "accuracy",
                        "display_name": "val acc"
                    }
                ]
            }
        }
    },
    "train": {
        "stages": [{
            "mode": "interleave",
            "training_pipelines": ["training_pipeline"],
            "validation_pipelines": ["training_pipeline", "evaluation_pipeline"],
            "stop_condition": {
                "class": "torchassistant.stop_conditions.EpochsCompleted",
                "kwargs": {
                    "num_epochs": 3
                }
            }
        }]
    }
}