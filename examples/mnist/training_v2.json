{
    "session_dir": "pretrained",
    "initialize": {
        "definitions": [
            {
                "group": "preprocessors",
                "name": "normalizer",
                "spec": {
                    "class": "torchassistant.preprocessors.SimpleNormalizer"
                }
            },
            {
                "group": "datasets",
                "name": "train_ds",
                "spec": {
                    "class": "torchvision.datasets.MNIST",
                    "args": ["data"],
                    "kwargs": {
                        "train": true,
                        "download": true
                    }
                }
            },
            {
                "group": "datasets",
                "name": "test_ds",
                "spec": {
                    "class": "torchvision.datasets.MNIST",
                    "args": ["data"],
                    "kwargs": {
                        "train": false,
                        "download": true
                    }
                }
            },
            {
                "group": "collators",
                "name": "my_collator",
                "spec": {
                    "class": "torchassistant.collators.BatchDivide"
                }
            },
            {
                "group": "loader_factories",
                "name": "training_factory",
                "spec": {
                    "dataset": "train_ds",
                    "collator": "my_collator",
                    "kwargs": {
                        "batch_size": 32,
                        "num_workers": 2
                    }
                }
            },
            {
                "group": "loader_factories",
                "name": "test_factory",
                "spec": {
                    "dataset": "test_ds",
                    "collator": "my_collator",
                    "kwargs": {
                        "batch_size": 32,
                        "num_workers": 2
                    }
                }
            },
            {
                "group": "models",
                "name": "LeNet5",
                "spec": {
                    "class": "examples.mnist.LeNet5"
                }
            },
            {
                "group": "optimizers",
                "name": "optimizer",
                "spec": {
                    "class": "Adam",
                    "kwargs": {
                        "lr": 0.01
                    },
                    "model": "LeNet5"
                }
            },
            {
                "group": "losses",
                "name": "cross_entropy",
                "spec": {
                    "class": "CrossEntropyLoss",
                    "inputs": ["y_hat", "y"],
                    "transform": "examples.mnist.convert_labels"
                }
            },
            {
                "group": "metrics",
                "name": "accuracy",
                "spec": {
                    "class": "Accuracy",
                    "inputs": ["y_hat", "y"],
                    "transform": "examples.mnist.reverse_onehot"
                }
            },
            {
                "group": "batch_processors",
                "name": "LeNet_processor",
                "spec": {
                    "input_adapter": {
                        "class": "examples.mnist.InputAdapter"
                    },
                    "neural_graph": [
                        {
                            "model_name": "LeNet5",
                            "inputs": ["x"],
                            "outputs": ["y_hat"],
                            "optimizer_name": "optimizer"
                        }
                    ],
                    "device": "cpu"
                }
            },
            {
                "group": "batch_graphs",
                "name": "batch_processing_graph",
                "spec": {
                    "nodes": ["LeNet_processor"],
                    "input_aliases": ["input_batch"],
                    "ingoing_edges": {
                        "LeNet_processor": ["input_batch"]
                    }
                }
            }
        ],
        "pipelines": {
            "training_pipeline": {
                "graph": "batch_processing_graph",
                "input_factories": [
                    {
                        "input_alias": "input_batch",
                        "variable_names": ["images", "y"],
                        "loader_factory": "training_factory"
                    }
                ],
                "losses": [
                    {
                        "node_name": "LeNet_processor",
                        "loss_name": "cross_entropy",
                        "loss_display_name": "loss"
                    }
                ],
                "metrics": [
                    {
                        "node_name": "LeNet_processor",
                        "metric_name": "accuracy",
                        "display_name": "acc"
                    }
                ]
            },
            "evaluation_pipeline": {
                "graph": "batch_processing_graph",
                "input_factories": [
                    {
                        "input_alias": "input_batch",
                        "variable_names": ["images", "y"],
                        "loader_factory": "test_factory"
                    }
                ],
                "losses": [
                    {
                        "node_name": "LeNet_processor",
                        "loss_name": "cross_entropy",
                        "loss_display_name": "val loss"
                    }
                ],
                "metrics": [
                    {
                        "node_name": "LeNet_processor",
                        "metric_name": "accuracy",
                        "display_name": "val acc"
                    }
                ]
            }
        }
    },
    "train": {
        "stages": [{
            "mode": "interleave",
            "training_pipelines": ["training_pipeline"],
            "validation_pipelines": ["training_pipeline", "evaluation_pipeline"],
            "stop_condition": {
                "class": "torchassistant.stop_conditions.EpochsCompleted",
                "kwargs": {
                    "num_epochs": 20
                }
            }
        }]
    }
}